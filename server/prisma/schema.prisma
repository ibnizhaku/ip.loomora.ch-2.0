// Loomora ERP Database Schema
// Swiss-compliant ERP with QR-Rechnung support

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  ADMIN
  MANAGER
  EMPLOYEE
  READONLY
}

enum DocumentStatus {
  DRAFT
  SENT
  CONFIRMED
  CANCELLED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PARTIAL
  PAID
  OVERDUE
  CANCELLED
}

enum PaymentMethod {
  BANK_TRANSFER
  CREDIT_CARD
  TWINT
  PAYPAL
  CASH
  INVOICE
}

enum VatRate {
  STANDARD    // 8.1%
  REDUCED     // 2.6%
  SPECIAL     // 3.8%
  EXEMPT      // 0%
}

enum ReminderLevel {
  FIRST
  SECOND
  THIRD
}

// ============================================
// CORE / SYSTEM
// ============================================

model Company {
  id            String   @id @default(cuid())
  name          String
  legalName     String?
  street        String?
  zipCode       String?
  city          String?
  country       String   @default("CH")
  phone         String?
  email         String?
  website       String?
  vatNumber     String?  // CHE-123.456.789
  iban          String?
  bic           String?
  bankName      String?
  logoUrl       String?
  
  // Settings as JSON
  settings      Json     @default("{}")
  
  // Numbering (current counters)
  invoiceCounter    Int  @default(0)
  quoteCounter      Int  @default(0)
  orderCounter      Int  @default(0)
  deliveryCounter   Int  @default(0)
  creditNoteCounter Int  @default(0)
  purchaseCounter   Int  @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  users         User[]
  customers     Customer[]
  suppliers     Supplier[]
  products      Product[]
  categories    ProductCategory[]
  quotes        Quote[]
  orders        Order[]
  invoices      Invoice[]
  creditNotes   CreditNote[]
  deliveryNotes DeliveryNote[]
  purchaseOrders PurchaseOrder[]
  purchaseInvoices PurchaseInvoice[]
  payments      Payment[]
  bankAccounts  BankAccount[]
  chartOfAccounts ChartOfAccount[]
  journalEntries JournalEntry[]
  
  @@map("companies")
}

model User {
  id            String   @id @default(cuid())
  email         String   @unique
  passwordHash  String
  firstName     String
  lastName      String
  phone         String?
  avatarUrl     String?
  role          UserRole @default(EMPLOYEE)
  isActive      Boolean  @default(true)
  twoFactorEnabled Boolean @default(false)
  lastLoginAt   DateTime?
  
  companyId     String
  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  createdQuotes     Quote[]    @relation("QuoteCreator")
  createdOrders     Order[]    @relation("OrderCreator")
  createdInvoices   Invoice[]  @relation("InvoiceCreator")
  
  @@index([companyId])
  @@index([email])
  @@map("users")
}

model Setting {
  id        String   @id @default(cuid())
  companyId String
  key       String
  value     Json
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@unique([companyId, key])
  @@map("settings")
}

// ============================================
// CRM / CONTACTS
// ============================================

model Customer {
  id              String   @id @default(cuid())
  number          String   // KD-0001
  name            String
  companyName     String?
  salutation      String?
  street          String?
  zipCode         String?
  city            String?
  country         String   @default("CH")
  phone           String?
  email           String?
  website         String?
  vatNumber       String?
  
  // Payment terms
  paymentTermDays Int      @default(30)
  creditLimit     Decimal? @db.Decimal(12, 2)
  discount        Decimal? @db.Decimal(5, 2)  // Default discount %
  
  notes           String?
  isActive        Boolean  @default(true)
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  contacts        Contact[]
  quotes          Quote[]
  orders          Order[]
  invoices        Invoice[]
  creditNotes     CreditNote[]
  deliveryNotes   DeliveryNote[]
  payments        Payment[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@index([email])
  @@map("customers")
}

model Supplier {
  id              String   @id @default(cuid())
  number          String   // LI-0001
  name            String
  companyName     String?
  street          String?
  zipCode         String?
  city            String?
  country         String   @default("CH")
  phone           String?
  email           String?
  website         String?
  vatNumber       String?
  iban            String?
  
  paymentTermDays Int      @default(30)
  notes           String?
  isActive        Boolean  @default(true)
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  contacts        Contact[]
  purchaseOrders  PurchaseOrder[]
  purchaseInvoices PurchaseInvoice[]
  products        Product[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@map("suppliers")
}

model Contact {
  id          String   @id @default(cuid())
  firstName   String
  lastName    String
  position    String?
  phone       String?
  mobile      String?
  email       String?
  isPrimary   Boolean  @default(false)
  notes       String?
  
  customerId  String?
  customer    Customer? @relation(fields: [customerId], references: [id], onDelete: Cascade)
  
  supplierId  String?
  supplier    Supplier? @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([customerId])
  @@index([supplierId])
  @@map("contacts")
}

// ============================================
// PRODUCTS / INVENTORY
// ============================================

model ProductCategory {
  id          String   @id @default(cuid())
  name        String
  description String?
  parentId    String?
  parent      ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    ProductCategory[] @relation("CategoryHierarchy")
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  products    Product[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([companyId])
  @@map("product_categories")
}

model Product {
  id              String   @id @default(cuid())
  sku             String   // ART-0001
  name            String
  description     String?
  
  unit            String   @default("Stk")  // Stk, kg, m, m², lfm, h
  
  purchasePrice   Decimal  @db.Decimal(12, 2)
  salePrice       Decimal  @db.Decimal(12, 2)
  vatRate         VatRate  @default(STANDARD)
  
  // Inventory
  stockQuantity   Decimal  @default(0) @db.Decimal(12, 3)
  minStock        Decimal? @db.Decimal(12, 3)
  maxStock        Decimal? @db.Decimal(12, 3)
  
  // Dimensions (for shipping)
  weight          Decimal? @db.Decimal(10, 3)  // kg
  length          Decimal? @db.Decimal(10, 2)  // cm
  width           Decimal? @db.Decimal(10, 2)
  height          Decimal? @db.Decimal(10, 2)
  
  imageUrl        String?
  isActive        Boolean  @default(true)
  isService       Boolean  @default(false)
  
  categoryId      String?
  category        ProductCategory? @relation(fields: [categoryId], references: [id])
  
  supplierId      String?
  supplier        Supplier? @relation(fields: [supplierId], references: [id])
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  quoteItems      QuoteItem[]
  orderItems      OrderItem[]
  invoiceItems    InvoiceItem[]
  inventoryMovements InventoryMovement[]
  
  @@unique([companyId, sku])
  @@index([companyId])
  @@index([categoryId])
  @@map("products")
}

model InventoryMovement {
  id          String   @id @default(cuid())
  productId   String
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  type        String   // IN, OUT, ADJUSTMENT, RETURN
  quantity    Decimal  @db.Decimal(12, 3)
  reference   String?  // Order number, etc.
  notes       String?
  
  createdAt   DateTime @default(now())
  
  @@index([productId])
  @@map("inventory_movements")
}

// ============================================
// SALES: QUOTES
// ============================================

model Quote {
  id              String   @id @default(cuid())
  number          String   // AN-2024-0001
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  date            DateTime @default(now())
  validUntil      DateTime
  status          DocumentStatus @default(DRAFT)
  
  // Address (snapshot)
  billingAddress  Json?
  shippingAddress Json?
  
  // Totals
  subtotal        Decimal  @db.Decimal(12, 2)
  discountPercent Decimal? @db.Decimal(5, 2)
  discountAmount  Decimal? @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  
  notes           String?
  internalNotes   String?
  terms           String?
  
  createdById     String
  createdBy       User     @relation("QuoteCreator", fields: [createdById], references: [id])
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           QuoteItem[]
  orders          Order[]  // Converted orders
  
  @@unique([companyId, number])
  @@index([companyId])
  @@index([customerId])
  @@map("quotes")
}

model QuoteItem {
  id          String   @id @default(cuid())
  quoteId     String
  quote       Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)
  
  position    Int
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  
  description String
  quantity    Decimal  @db.Decimal(12, 3)
  unit        String
  unitPrice   Decimal  @db.Decimal(12, 2)
  discount    Decimal? @db.Decimal(5, 2)
  vatRate     VatRate  @default(STANDARD)
  total       Decimal  @db.Decimal(12, 2)
  
  @@index([quoteId])
  @@map("quote_items")
}

// ============================================
// SALES: ORDERS
// ============================================

model Order {
  id              String   @id @default(cuid())
  number          String   // AU-2024-0001
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  quoteId         String?
  quote           Quote?   @relation(fields: [quoteId], references: [id])
  
  date            DateTime @default(now())
  deliveryDate    DateTime?
  status          DocumentStatus @default(DRAFT)
  
  billingAddress  Json?
  shippingAddress Json?
  
  subtotal        Decimal  @db.Decimal(12, 2)
  discountPercent Decimal? @db.Decimal(5, 2)
  discountAmount  Decimal? @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  
  notes           String?
  internalNotes   String?
  
  createdById     String
  createdBy       User     @relation("OrderCreator", fields: [createdById], references: [id])
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           OrderItem[]
  invoices        Invoice[]
  deliveryNotes   DeliveryNote[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@index([customerId])
  @@map("orders")
}

model OrderItem {
  id          String   @id @default(cuid())
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  
  position    Int
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  
  description String
  quantity    Decimal  @db.Decimal(12, 3)
  unit        String
  unitPrice   Decimal  @db.Decimal(12, 2)
  discount    Decimal? @db.Decimal(5, 2)
  vatRate     VatRate  @default(STANDARD)
  total       Decimal  @db.Decimal(12, 2)
  
  // Delivery tracking
  deliveredQty Decimal @default(0) @db.Decimal(12, 3)
  
  @@index([orderId])
  @@map("order_items")
}

// ============================================
// SALES: DELIVERY NOTES
// ============================================

model DeliveryNote {
  id              String   @id @default(cuid())
  number          String   // LS-2024-0001
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  orderId         String?
  order           Order?   @relation(fields: [orderId], references: [id])
  
  date            DateTime @default(now())
  shippedAt       DateTime?
  deliveredAt     DateTime?
  
  shippingAddress Json?
  trackingNumber  String?
  carrier         String?
  
  notes           String?
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           DeliveryNoteItem[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@index([customerId])
  @@map("delivery_notes")
}

model DeliveryNoteItem {
  id              String   @id @default(cuid())
  deliveryNoteId  String
  deliveryNote    DeliveryNote @relation(fields: [deliveryNoteId], references: [id], onDelete: Cascade)
  
  position        Int
  description     String
  quantity        Decimal  @db.Decimal(12, 3)
  unit            String
  
  @@index([deliveryNoteId])
  @@map("delivery_note_items")
}

// ============================================
// SALES: INVOICES
// ============================================

model Invoice {
  id              String   @id @default(cuid())
  number          String   // RE-2024-0001
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  orderId         String?
  order           Order?   @relation(fields: [orderId], references: [id])
  
  date            DateTime @default(now())
  dueDate         DateTime
  status          InvoiceStatus @default(DRAFT)
  
  billingAddress  Json?
  
  subtotal        Decimal  @db.Decimal(12, 2)
  discountPercent Decimal? @db.Decimal(5, 2)
  discountAmount  Decimal? @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  paidAmount      Decimal  @default(0) @db.Decimal(12, 2)
  
  // Swiss QR-Rechnung
  qrReference     String?  // 26-digit reference
  qrIban          String?
  
  notes           String?
  internalNotes   String?
  paymentTerms    String?
  
  createdById     String
  createdBy       User     @relation("InvoiceCreator", fields: [createdById], references: [id])
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           InvoiceItem[]
  payments        Payment[]
  reminders       Reminder[]
  creditNotes     CreditNote[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@index([customerId])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  position    Int
  productId   String?
  product     Product? @relation(fields: [productId], references: [id])
  
  description String
  quantity    Decimal  @db.Decimal(12, 3)
  unit        String
  unitPrice   Decimal  @db.Decimal(12, 2)
  discount    Decimal? @db.Decimal(5, 2)
  vatRate     VatRate  @default(STANDARD)
  total       Decimal  @db.Decimal(12, 2)
  
  @@index([invoiceId])
  @@map("invoice_items")
}

model Reminder {
  id          String   @id @default(cuid())
  invoiceId   String
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  level       ReminderLevel
  sentAt      DateTime?
  dueDate     DateTime
  fee         Decimal  @default(0) @db.Decimal(10, 2)  // Mahngebühr
  
  createdAt   DateTime @default(now())
  
  @@index([invoiceId])
  @@map("reminders")
}

// ============================================
// SALES: CREDIT NOTES
// ============================================

model CreditNote {
  id              String   @id @default(cuid())
  number          String   // GS-2024-0001
  
  customerId      String
  customer        Customer @relation(fields: [customerId], references: [id])
  
  invoiceId       String?
  invoice         Invoice? @relation(fields: [invoiceId], references: [id])
  
  date            DateTime @default(now())
  reason          String?
  
  subtotal        Decimal  @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  
  notes           String?
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           CreditNoteItem[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@map("credit_notes")
}

model CreditNoteItem {
  id            String   @id @default(cuid())
  creditNoteId  String
  creditNote    CreditNote @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  
  position      Int
  description   String
  quantity      Decimal  @db.Decimal(12, 3)
  unit          String
  unitPrice     Decimal  @db.Decimal(12, 2)
  vatRate       VatRate  @default(STANDARD)
  total         Decimal  @db.Decimal(12, 2)
  
  @@index([creditNoteId])
  @@map("credit_note_items")
}

// ============================================
// PURCHASING
// ============================================

model PurchaseOrder {
  id              String   @id @default(cuid())
  number          String   // BE-2024-0001
  
  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id])
  
  date            DateTime @default(now())
  expectedDate    DateTime?
  status          DocumentStatus @default(DRAFT)
  
  subtotal        Decimal  @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  
  notes           String?
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  items           PurchaseOrderItem[]
  purchaseInvoices PurchaseInvoice[]
  
  @@unique([companyId, number])
  @@index([companyId])
  @@map("purchase_orders")
}

model PurchaseOrderItem {
  id              String   @id @default(cuid())
  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  
  position        Int
  description     String
  quantity        Decimal  @db.Decimal(12, 3)
  unit            String
  unitPrice       Decimal  @db.Decimal(12, 2)
  vatRate         VatRate  @default(STANDARD)
  total           Decimal  @db.Decimal(12, 2)
  
  @@index([purchaseOrderId])
  @@map("purchase_order_items")
}

model PurchaseInvoice {
  id              String   @id @default(cuid())
  number          String   // External invoice number
  
  supplierId      String
  supplier        Supplier @relation(fields: [supplierId], references: [id])
  
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])
  
  date            DateTime
  dueDate         DateTime
  status          InvoiceStatus @default(DRAFT)
  
  subtotal        Decimal  @db.Decimal(12, 2)
  vatAmount       Decimal  @db.Decimal(12, 2)
  total           Decimal  @db.Decimal(12, 2)
  paidAmount      Decimal  @default(0) @db.Decimal(12, 2)
  
  documentUrl     String?  // Uploaded PDF
  notes           String?
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([companyId])
  @@index([supplierId])
  @@map("purchase_invoices")
}

// ============================================
// FINANCE: PAYMENTS
// ============================================

model Payment {
  id          String   @id @default(cuid())
  
  invoiceId   String?
  invoice     Invoice? @relation(fields: [invoiceId], references: [id])
  
  customerId  String?
  customer    Customer? @relation(fields: [customerId], references: [id])
  
  date        DateTime @default(now())
  amount      Decimal  @db.Decimal(12, 2)
  method      PaymentMethod
  reference   String?  // Bank reference, transaction ID
  notes       String?
  
  bankAccountId String?
  bankAccount BankAccount? @relation(fields: [bankAccountId], references: [id])
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  
  @@index([companyId])
  @@index([invoiceId])
  @@map("payments")
}

// ============================================
// FINANCE: BANKING
// ============================================

model BankAccount {
  id          String   @id @default(cuid())
  name        String
  iban        String
  bic         String?
  bankName    String?
  currency    String   @default("CHF")
  balance     Decimal  @default(0) @db.Decimal(14, 2)
  isDefault   Boolean  @default(false)
  
  // For QR-Rechnung
  qrIban      String?
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  transactions BankTransaction[]
  payments    Payment[]
  
  @@index([companyId])
  @@map("bank_accounts")
}

model BankTransaction {
  id              String   @id @default(cuid())
  bankAccountId   String
  bankAccount     BankAccount @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)
  
  date            DateTime
  valueDate       DateTime?
  amount          Decimal  @db.Decimal(14, 2)
  currency        String   @default("CHF")
  description     String?
  reference       String?  // camt.054 reference
  counterpartName String?
  counterpartIban String?
  
  isMatched       Boolean  @default(false)
  matchedPaymentId String?
  
  importedAt      DateTime @default(now())
  
  @@index([bankAccountId])
  @@index([reference])
  @@map("bank_transactions")
}

// ============================================
// FINANCE: ACCOUNTING
// ============================================

model ChartOfAccount {
  id          String   @id @default(cuid())
  number      String   // 4-digit: 1000, 1100, etc.
  name        String
  type        String   // ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE
  parentId    String?
  parent      ChartOfAccount? @relation("AccountHierarchy", fields: [parentId], references: [id])
  children    ChartOfAccount[] @relation("AccountHierarchy")
  
  isActive    Boolean  @default(true)
  
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  debitEntries  JournalEntry[] @relation("DebitAccount")
  creditEntries JournalEntry[] @relation("CreditAccount")
  
  @@unique([companyId, number])
  @@index([companyId])
  @@map("chart_of_accounts")
}

model JournalEntry {
  id              String   @id @default(cuid())
  date            DateTime
  
  debitAccountId  String
  debitAccount    ChartOfAccount @relation("DebitAccount", fields: [debitAccountId], references: [id])
  
  creditAccountId String
  creditAccount   ChartOfAccount @relation("CreditAccount", fields: [creditAccountId], references: [id])
  
  amount          Decimal  @db.Decimal(14, 2)
  description     String?
  reference       String?  // Invoice number, etc.
  
  companyId       String
  company         Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime @default(now())
  
  @@index([companyId])
  @@index([date])
  @@map("journal_entries")
}

// ============================================
// AUDIT LOG
// ============================================

model AuditLog {
  id          String   @id @default(cuid())
  userId      String?
  action      String   // CREATE, UPDATE, DELETE
  entityType  String   // invoice, customer, etc.
  entityId    String
  oldValue    Json?
  newValue    Json?
  ipAddress   String?
  userAgent   String?
  
  createdAt   DateTime @default(now())
  
  @@index([entityType, entityId])
  @@index([userId])
  @@index([createdAt])
  @@map("audit_logs")
}
